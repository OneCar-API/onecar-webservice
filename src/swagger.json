{
  "openapi": "3.0.0",
  "info": {
    "title": "OneCar Documentation",
    "description": "Olá, essa é a documentação da API do OneCar. \n\n A API segue o padrão REST e todas suas respostas são em JSON. \n\n Quanto à autenticação, os serviços utilizam o seguinte método de validação: \n\n - Autenticação com token para a segurança. O usuário e senha devem ser de um usuário ativo na plataforma. \n\n Essa API usa como retorno os códigos HTTP padrões para indicar tanto o sucesso de uma requisição, quanto para indicar falha. Segue abaixo os principais: \n\n 1. 200 - Success \n\n 2. 401 - JWT token is missing / Invalid JWT token. Podem ainda ocorrer outros erros de validação ligados às regras de negócio e nestes casos serão tratados com o retorno do código de erro equivalente e uma mensagem explicativa (os respectivos códigos e mensagens estão listados no retorno de cada endpoint)",
    "version": "1.0.0",
    "contact": {
      "email": "contato@onecar.com.br"
    }
  },
  "paths": {
    "/user": {
      "post": {
        "tags": ["Users"],
        "summary": "Cadastrar usuários",
        "description": "Essa rota permite o cadastro de um usuário",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "nickname": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  },
                  "phone": {
                    "type": "string"
                  },
                  "document": {
                    "type": "string"
                  },
                  "cnpj": {
                    "type": "string"
                  }
                },
                "example": {
                  "name": "John Doe",
                  "nickname": "john.doe",
                  "email": "johndoe@example.com",
                  "password": "123456",
                  "phone": "12988786060",
                  "document": "90089747890",
                  "cnpj": "23987679000123"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success"
          },
          "401": {
            "description": "Email address already in use"
          }
        }
      }
    },

    "/users/import": {
      "post": {
        "tags": ["Users"],
        "summary": "Importar usuários",
        "description": "Essa rota permite a importação de um arquivo CSV contendo as informações dos usuários",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file-users": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Your file has been imported",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "message": {
                        "type": "string"
                      },
                      "usersFailed": [
                        {
                          "name": {
                            "type": "string"
                          },
                          "nickname": {
                            "type": "string"
                          },
                          "document": {
                            "type": "string"
                          },
                          "phone": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string"
                          },
                          "address": {
                            "zip_code": {
                              "type": "string"
                            },
                            "neighborhood": {
                              "type": "string"
                            },
                            "city": {
                              "type": "string"
                            },
                            "state": {
                              "type": "string"
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },

    "/users?user=&address=": {
      "get": {
        "tags": ["Users"],
        "summary": "Busca todos os usuários da plataforma",
        "description": "Essa rota permite buscar todos os usuários da plataforma.",
        "parameters": [
          {
            "name": "user",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Parâmetro que permite filtrar pelo nome, e-mail e telefone do usuário."
            }
          },
          {
            "name": "address",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Parâmetro que permite filtrar pela cidade e estado do usuário."
            }
          },
          {
            "name": "offset",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Parâmetro que determina o index pelo qual se deve iniciar a consulta."
            }
          },
          {
            "name": "limit",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "description": "Parâmetro que limita a quantidade de resultados por página."
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "total": {
                        "type": "number"
                      },
                      "previous": {
                        "type": "boolean"
                      },
                      "next": {
                        "type": "boolean"
                      },
                      "results": [
                        {
                          "id": {
                            "type": "uuid"
                          },
                          "name": {
                            "type": "string"
                          },
                          "email": {
                            "type": "string"
                          },
                          "phone": {
                            "type": "string"
                          },
                          "created_at": {
                            "type": "number"
                          },
                          "address": {
                            "id": {
                              "type": "uuid"
                            },
                            "city": {
                              "type": "string"
                            },
                            "state": {
                              "type": "string"
                            }
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "JWT token is missing / Invalid JWT token"
          }
        }
      }
    },

    "/user/{id}": {
      "get": {
        "tags": ["Users"],
        "summary": "Busca um usuário através do ID",
        "description": "Essa rota permite buscar apenas um usuário por vez. O ID deve estar contido no parâmetro da URL.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "description": "ID do usuário que deseja buscar",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "uuid"
                      },
                      "name": {
                        "type": "string"
                      },
                      "nickname": {
                        "type": "string"
                      },
                      "email": {
                        "type": "string"
                      },
                      "phone": {
                        "type": "string"
                      },
                      "document": {
                        "type": "string"
                      },
                      "cnpj": {
                        "type": "string"
                      },
                      "is_legal": {
                        "type": "boolean"
                      },
                      "is_active": {
                        "type": "boolean"
                      },
                      "created_at": {
                        "type": "number"
                      },
                      "updated_at": {
                        "type": "number"
                      },
                      "address": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "uuid"
                          },
                          "zip_code": {
                            "type": "string"
                          },
                          "neighborhood": {
                            "type": "string"
                          },
                          "city": {
                            "type": "string"
                          },
                          "state": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "JWT token is missing / Invalid JWT token"
          },
          "404": {
            "description": "User not found"
          }
        }
      }
    },

    "/user/confirm": {
      "patch": {
        "tags": ["Confirm Users"],
        "summary": "Confirmação do cadastro do usuário através do token",
        "description": "Após confirmação do cadastro, o campo active do usuário mudará para true, indicando que agora ele é um usuário ativo.",
        "security": {
          "Bearer": []
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string"
                  }
                },
                "example": {
                  "token": "5a3df27f-833b-4fb6-8601-74564ceb9cc7"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Your account was successfully confirmed"
          },
          "401": {
            "description": "Token expired"
          },
          "404": {
            "description": "User does not exists / User token does not exists"
          }
        }
      }
    },

    "/user/confirm/update-token": {
      "put": {
        "tags": ["Confirm Users"],
        "summary": "Atualização da data de expiração do token",
        "description": "Caso o token do usuário expire, essa rota deve ser chamada para que a data seja atualizada e um novo e-mail de confirmação de cadastro seja enviado ao cliente.",
        "security": {
          "Bearer": []
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string"
                  }
                },
                "example": {
                  "id": "5a3df27f-833b-4fb6-8601-74564ceb9cc7"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "New e-mail confirmation was sent"
          },
          "404": {
            "description": "User does not exists / User token does not exists"
          }
        }
      }
    },

    "/password/forgot": {
      "post": {
        "tags": ["Forgot Password"],
        "summary": "Envio de e-mail de recuperação de senha",
        "description": "O e-mail enviado ao usuário contará com um link de recuperação de senha, que conterá um token para que seja autorizado a recuperar sua senha.",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string"
                  }
                },
                "example": {
                  "email": "johndoe@example.com"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Sent a email to reset password"
          },
          "404": {
            "description": "User does not exist"
          }
        }
      }
    },

    "/password/reset": {
      "post": {
        "tags": ["Reset Password"],
        "summary": "Reset da senha através do link de recuperação de senha",
        "description": "Apenas usuários vindos através deste link que terão acesso à página para resetar senha.",
        "security": {
          "Bearer": []
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "token": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  },
                  "password_confirmation": {
                    "type": "string"
                  }
                },
                "example": {
                  "token": "5a3df27f-833b-4fb6-8601-74564ceb9cc7",
                  "password": "567890",
                  "password_confirmation": "567890"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Your password was changed successfully"
          },
          "401": {
            "description": "Token expired"
          },
          "404": {
            "description": "User does not exists / User token does not exists"
          }
        }
      }
    },

    "/sessions": {
      "post": {
        "tags": ["Sessions"],
        "summary": "Autenticação do usuário",
        "description": "Essa rota permite o login do usuário, fornecendo o token de autenticação",
        "security": {
          "Bearer": []
        },
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string"
                  },
                  "password": {
                    "type": "string"
                  }
                },
                "example": {
                  "email": "johndoe@example.com",
                  "password": "123456"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success"
          },
          "401": {
            "description": "Incorrect email/password combination"
          }
        }
      }
    }
  },

  "definitions": {
    "users": {
      "type": "object",
      "required": [
        "id",
        "name",
        "nickname",
        "password",
        "email",
        "document",
        "is_legal"
      ],
      "properties": {
        "id": {
          "type": "uuid"
        },
        "name": {
          "type": "string"
        },
        "nickname": {
          "type": "string"
        },
        "password": {
          "type": "string"
        },
        "email": {
          "type": "string"
        },
        "phone": {
          "type": "string"
        },
        "document": {
          "type": "string"
        },
        "cnpj": {
          "type": "string"
        },
        "is_legal": {
          "type": "boolean",
          "default": false
        },
        "created_at": {
          "type": "timestamp with time zone"
        },
        "updated_at": {
          "type": "timestamp with time zone"
        }
      }
    },

    "user_tokens": {
      "type": "object",
      "required": [
        "id",
        "user_id",
        "token"
      ],
      "properties": {
        "id": {
          "type": "uuid"
        },
        "user_id": {
          "type": "uuid (FK)"
        },
        "token": {
          "type": "uuid"
        },
        "created_at": {
          "type": "timestamp with time zone"
        },
        "updated_at": {
          "type": "timestamp with time zone"
        }
      }
    },

    "addresses": {
      "type": "object",
      "required": [
        "id",
        "zip_code",
        "user_id"
      ],
      "properties": {
        "id": {
          "type": "uuid"
        },
        "zip_code": {
          "type": "string"
        },
        "neighborhood": {
          "type": "string"
        },
        "city": {
          "type": "string"
        },
        "state": {
          "type": "string"
        },
        "user_id": {
          "type": "uuid (FK)"
        },
        "created_at": {
          "type": "timestamp with time zone"
        },
        "updated_at": {
          "type": "timestamp with time zone"
        }
      }
    }
  },

  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
